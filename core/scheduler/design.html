
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>调度器设计 · 《k8s-1.13版本源码分析》</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Tao Hu <farmer.hutao@outlook.com>">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-codeblock-filename/block.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-navigator/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-multipart/multipart.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-donate/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="before-scheduler-run.html" />
    
    
    <link rel="prev" href="./" />
    

    <style>
    @media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }
    </style>
    <script>
        window["gitbook-plugin-github-buttons"] = {"repo":"farmer-hutao/k8s-source-code-analysis","types":["star"],"size":"small"};
    </script>

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Part I - 准备工作</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                        <b>1.1.</b>
                    
                    前言
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../prepare/">
            
                <a href="../../prepare/">
            
                    
                        <b>1.2.</b>
                    
                    k8s源码分析准备工作
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../../prepare/get-code.html">
            
                <a href="../../prepare/get-code.html">
            
                    
                        <b>1.2.1.</b>
                    
                    源码准备
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../../prepare/debug-environment.html">
            
                <a href="../../prepare/debug-environment.html">
            
                    
                        <b>1.2.2.</b>
                    
                    测试环境搭建-单节点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../../prepare/debug-environment-3node.html">
            
                <a href="../../prepare/debug-environment-3node.html">
            
                    
                        <b>1.2.3.</b>
                    
                    测试环境搭建-三节点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../../prepare/debug.html">
            
                <a href="../../prepare/debug.html">
            
                    
                        <b>1.2.4.</b>
                    
                    源码调试
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Part II - 核心组件</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../">
            
                <a href="../">
            
                    
                        <b>2.1.</b>
                    
                    概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="./">
            
                <a href="./">
            
                    
                        <b>2.2.</b>
                    
                    scheduler
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="2.2.1" data-path="design.html">
            
                <a href="design.html">
            
                    
                        <b>2.2.1.</b>
                    
                    调度器设计
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.2" data-path="before-scheduler-run.html">
            
                <a href="before-scheduler-run.html">
            
                    
                        <b>2.2.2.</b>
                    
                    调度程序启动前逻辑
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3" data-path="scheduler-framework.html">
            
                <a href="scheduler-framework.html">
            
                    
                        <b>2.2.3.</b>
                    
                    调度器框架
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.4" data-path="generic-scheduler.html">
            
                <a href="generic-scheduler.html">
            
                    
                        <b>2.2.4.</b>
                    
                    一般调度过程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.5" data-path="predicate.html">
            
                <a href="predicate.html">
            
                    
                        <b>2.2.5.</b>
                    
                    预选过程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.6" data-path="priority.html">
            
                <a href="priority.html">
            
                    
                        <b>2.2.6.</b>
                    
                    优选过程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.7" data-path="preempt.html">
            
                <a href="preempt.html">
            
                    
                        <b>2.2.7.</b>
                    
                    抢占调度
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.8" data-path="init.html">
            
                <a href="init.html">
            
                    
                        <b>2.2.8.</b>
                    
                    调度器初始化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.9" data-path="struct.html">
            
                <a href="struct.html">
            
                    
                        <b>2.2.9.</b>
                    
                    关键数据结构分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../controller-manager/">
            
                <a href="../controller-manager/">
            
                    
                        <b>2.3.</b>
                    
                    controller-manager
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="../controller-manager/controller.html">
            
                <a href="../controller-manager/controller.html">
            
                    
                        <b>2.3.1.</b>
                    
                    控制器概述
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../apiserver/">
            
                <a href="../apiserver/">
            
                    
                        <b>2.4.</b>
                    
                    apiserver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../proxy/">
            
                <a href="../proxy/">
            
                    
                        <b>2.5.</b>
                    
                    proxy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="../kubelet/">
            
                <a href="../kubelet/">
            
                    
                        <b>2.6.</b>
                    
                    kubelet
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Part III - 周边项目</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../../around/">
            
                <a href="../../around/">
            
                    
                        <b>3.1.</b>
                    
                    概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../../around/client-go/">
            
                <a href="../../around/client-go/">
            
                    
                        <b>3.2.</b>
                    
                    client-go
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" data-path="../../around/client-go/informer.html">
            
                <a href="../../around/client-go/informer.html">
            
                    
                        <b>3.2.1.</b>
                    
                    Informer机制
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >调度器设计</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="&#x8C03;&#x5EA6;&#x5668;&#x8BBE;&#x8BA1;">&#x8C03;&#x5EA6;&#x5668;&#x8BBE;&#x8BA1;</h1>
<!-- toc -->
<ul>
<li><a href="#%E6%A6%82%E8%BF%B0">&#x6982;&#x8FF0;</a></li>
<li><a href="#%E6%BA%90%E7%A0%81%E5%B1%82%E7%BA%A7">&#x6E90;&#x7801;&#x5C42;&#x7EA7;</a></li>
<li><a href="#%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95">&#x8C03;&#x5EA6;&#x7B97;&#x6CD5;</a></li>
<li><a href="#predicates-%E5%92%8C-priorities-%E7%AD%96%E7%95%A5">Predicates &#x548C; priorities &#x7B56;&#x7565;</a></li>
<li><a href="#scheduler-%E7%9A%84%E6%8B%93%E5%B1%95%E6%80%A7">Scheduler &#x7684;&#x62D3;&#x5C55;&#x6027;</a></li>
<li><a href="#%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5%E7%9A%84%E4%BF%AE%E6%94%B9">&#x8C03;&#x5EA6;&#x7B56;&#x7565;&#x7684;&#x4FEE;&#x6539;</a></li>
</ul>
<!-- tocstop -->
<h2 id="&#x6982;&#x8FF0;">1. &#x6982;&#x8FF0;</h2>
<p>&#x6211;&#x4EEC;&#x5148;&#x6574;&#x4F53;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;Scheduler&#x7684;&#x8BBE;&#x8BA1;&#x539F;&#x7406;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x770B;&#x8FD9;&#x4E9B;&#x8FC7;&#x7A0B;&#x662F;&#x5982;&#x4F55;&#x7528;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x5173;&#x4E8E;&#x8C03;&#x5EA6;&#x5668;&#x7684;&#x8BBE;&#x8BA1;&#x5728;&#x5B98;&#x7F51;&#x6709;&#x4ECB;&#x7ECD;&#xFF0C;&#x6211;&#x4E0B;&#x9762;&#x7ED3;&#x5408;&#x5B98;&#x7F51;&#x7ED9;&#x7684;&#x8BF4;&#x660E;&#xFF0C;&#x7B80;&#x5316;&#x6389;&#x4E0D;&#x5F71;&#x54CD;&#x7406;&#x89E3;&#x7684;&#x590D;&#x6742;&#x90E8;&#x5206;&#xFF0C;&#x548C;&#x5927;&#x5BB6;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;Scheduler&#x7684;&#x5DE5;&#x4F5C;&#x8FC7;&#x7A0B;&#x3002;</p>
<p>&#x82F1;&#x6587;&#x8FD8;&#x53EF;&#x4EE5;&#x7684;&#x5C0F;&#x4F19;&#x4F34;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x4E00;&#x4E0B;&#x5B98;&#x7F51;&#x7684;&#x4ECB;&#x7ECD;&#x5148;&#xFF1A;<a href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-scheduling/scheduler.md" target="_blank">scheduler.md</a></p>
<p>&#x5B98;&#x7F51;&#x6709;&#x4E00;&#x6BB5;&#x63CF;&#x8FF0;&#x5982;&#x4E0B;&#xFF1A;</p>
<p>The Kubernetes scheduler runs as a process alongside the other master components such as the API server. Its interface to the API server is to watch for Pods with an empty PodSpec.NodeName, and for each Pod, it posts a binding indicating where the Pod should be scheduled.</p>
<p>&#x7B80;&#x5355;&#x7FFB;&#x8BD1;&#x4E00;&#x4E0B;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;Scheduler&#x662F;&#x4E00;&#x4E2A;&#x8DD1;&#x5728;&#x5176;&#x4ED6;&#x7EC4;&#x4EF6;&#x8FB9;&#x4E0A;&#x7684;&#x72EC;&#x7ACB;&#x7A0B;&#x5E8F;&#xFF0C;&#x5BF9;&#x63A5;Apiserver&#x5BFB;&#x627E;PodSpec.NodeName&#x4E3A;&#x7A7A;&#x7684;Pod&#xFF0C;&#x7136;&#x540E;&#x7528;post&#x7684;&#x65B9;&#x5F0F;&#x53D1;&#x9001;&#x4E00;&#x4E2A;api&#x8C03;&#x7528;&#xFF0C;&#x6307;&#x5B9A;&#x8FD9;&#x4E9B;pod&#x5E94;&#x8BE5;&#x8DD1;&#x5728;&#x54EA;&#x4E2A;node&#x4E0A;&#x3002;</p>
<p>&#x901A;&#x4FD7;&#x5730;&#x8BF4;&#xFF0C;&#x5C31;&#x662F;scheduler&#x662F;&#x76F8;&#x5BF9;&#x72EC;&#x7ACB;&#x7684;&#x4E00;&#x4E2A;&#x7EC4;&#x4EF6;&#xFF0C;&#x4E3B;&#x52A8;&#x8BBF;&#x95EE;api server&#xFF0C;&#x5BFB;&#x627E;&#x7B49;&#x5F85;&#x8C03;&#x5EA6;&#x7684;pod&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x8C03;&#x5EA6;&#x7B97;&#x6CD5;&#x5BFB;&#x627E;&#x54EA;&#x4E2A;node&#x9002;&#x5408;&#x8DD1;&#x8FD9;&#x4E2A;pod&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x8FD9;&#x4E2A;pod&#x548C;node&#x7684;&#x7ED1;&#x5B9A;&#x5173;&#x7CFB;&#x53D1;&#x7ED9;api server&#xFF0C;&#x4ECE;&#x800C;&#x5B8C;&#x6210;&#x4E86;&#x8C03;&#x5EA6;&#x7684;&#x8FC7;&#x7A0B;&#x3002;</p>
<h2 id="&#x6E90;&#x7801;&#x5C42;&#x7EA7;">2. &#x6E90;&#x7801;&#x5C42;&#x7EA7;</h2>
<p>&#x4ECE;&#x9AD8;level&#x770B;&#xFF0C;scheduler&#x7684;&#x6E90;&#x7801;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;3&#x5C42;&#xFF1A;</p>
<ul>
<li><code>cmd/kube-scheduler/scheduler.go</code>: main() &#x51FD;&#x6570;&#x5165;&#x53E3;&#x4F4D;&#x7F6E;&#xFF0C;&#x5728;scheduler&#x8FC7;&#x7A0B;&#x5F00;&#x59CB;&#x88AB;&#x8C03;&#x7528;&#x524D;&#x7684;&#x4E00;&#x7CFB;&#x5217;&#x521D;&#x59CB;&#x5316;&#x5DE5;&#x4F5C;&#x3002;</li>
<li><code>pkg/scheduler/scheduler.go</code>: &#x8C03;&#x5EA6;&#x6846;&#x67B6;&#x7684;&#x6574;&#x4F53;&#x903B;&#x8F91;&#xFF0C;&#x5728;&#x5177;&#x4F53;&#x7684;&#x8C03;&#x5EA6;&#x7B97;&#x6CD5;&#x4E4B;&#x4E0A;&#x7684;&#x6846;&#x67B6;&#x6027;&#x7684;&#x4EE3;&#x7801;&#x3002;</li>
<li><code>pkg/scheduler/core/generic_scheduler.go</code>: &#x5177;&#x4F53;&#x7684;&#x8BA1;&#x7B97;&#x54EA;&#x4E9B;node&#x9002;&#x5408;&#x8DD1;&#x54EA;&#x4E9B;pod&#x7684;&#x7B97;&#x6CD5;&#x3002;</li>
</ul>
<h2 id="&#x8C03;&#x5EA6;&#x7B97;&#x6CD5;">3. &#x8C03;&#x5EA6;&#x7B97;&#x6CD5;</h2>
<p>&#x8C03;&#x5EA6;&#x8FC7;&#x7A0B;&#x6574;&#x4F53;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF08;&#x5B98;&#x6587;&#x91CC;&#x8FD9;&#x4E2A;&#x56FE;&#x6CA1;&#x5BF9;&#x9F50;&#xFF0C;&#x903C;&#x75AF;&#x5F3A;&#x8FEB;&#x75C7;&#x4E86;&#xFF01;&#xFF01;&#xFF01;&#x5F53;&#x7136;&#x7531;&#x4E8E;&#x4E2D;&#x6587;&#x663E;&#x793A;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4E0B;&#x56FE;&#x6709;&#x4E2D;&#x6587;&#x7684;&#x884C;&#x4E5F;&#x6CA1;&#x6CD5;&#x5B8C;&#x5168;&#x5BF9;&#x9F50;&#xFF0C;&#x8FD9;&#x4E2A;&#x5730;&#x65B9;&#x8BA9;&#x6211;&#x5F88;&#x6293;&#x72C2;&#x3002;&#x3002;&#x3002;&#xFF09;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;&#x7ED9;&#x5B9A;&#x7684;pod
+---------------------------------------------+
<span class="token operator">|</span>             &#x53EF;&#x7528;&#x4E8E;&#x8C03;&#x5EA6;&#x7684;nodes&#x5982;&#x4E0B;&#xFF1A;           <span class="token operator">|</span>
<span class="token operator">|</span>  +--------+     +--------+     +--------+   <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token operator">|</span> node 1 <span class="token operator">|</span>     <span class="token operator">|</span> node 2 <span class="token operator">|</span>     <span class="token operator">|</span> node 3 <span class="token operator">|</span>   <span class="token operator">|</span>
<span class="token operator">|</span>  +--------+     +--------+     +--------+   <span class="token operator">|</span>
+----------------------+----------------------+
                       <span class="token operator">|</span>
                       <span class="token function">v</span>
+----------------------+----------------------+
&#x521D;&#x6B65;&#x8FC7;&#x6EE4;: node 3 &#x8D44;&#x6E90;&#x4E0D;&#x8DB3;
+----------------------+----------------------+
                       <span class="token operator">|</span>
                       <span class="token function">v</span>
+----------------------+----------------------+
<span class="token operator">|</span>                 &#x5269;&#x4E0B;&#x7684;nodes:                 <span class="token operator">|</span>
<span class="token operator">|</span>     +--------+               +--------+     <span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token operator">|</span> node 1 <span class="token operator">|</span>               <span class="token operator">|</span> node 2 <span class="token operator">|</span>     <span class="token operator">|</span>
<span class="token operator">|</span>     +--------+               +--------+     <span class="token operator">|</span>
+----------------------+----------------------+
                       <span class="token operator">|</span>
                       <span class="token function">v</span>
+----------------------+----------------------+
&#x4F18;&#x5148;&#x7EA7;&#x7B97;&#x6CD5;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;:    node 1: &#x5206;&#x6570;<span class="token operator">=</span>2
                     node 2: &#x5206;&#x6570;<span class="token operator">=</span>5
+----------------------+----------------------+
                       <span class="token operator">|</span>
                       <span class="token function">v</span>
            &#x9009;&#x62E9;&#x5206;&#x503C;&#x6700;&#x9AD8;&#x7684;&#x8282;&#x70B9; <span class="token operator">=</span> node 2
</code></pre>
<p>Scheduler&#x4E3A;&#x6BCF;&#x4E2A;pod&#x5BFB;&#x627E;&#x4E00;&#x4E2A;&#x9002;&#x5408;&#x5176;&#x8FD0;&#x884C;&#x7684;node&#xFF0C;&#x5927;&#x4F53;&#x5206;&#x6210;&#x4E09;&#x6B65;&#xFF1A;</p>
<ol>
<li>&#x901A;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x201C;predicates&#x201D;&#x8FC7;&#x6EE4;&#x6389;&#x4E0D;&#x80FD;&#x8FD0;&#x884C;pod&#x7684;node&#xFF0C;&#x6BD4;&#x5982;&#x4E00;&#x4E2A;pod&#x9700;&#x8981;500M&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x6709;&#x4E9B;&#x8282;&#x70B9;&#x5269;&#x4F59;&#x5185;&#x5B58;&#x53EA;&#x6709;100M&#x4E86;&#xFF0C;&#x5C31;&#x4F1A;&#x88AB;&#x5254;&#x9664;&#xFF1B;</li>
<li>&#x901A;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x201C;priority functions&#x201D;&#x7ED9;&#x5269;&#x4E0B;&#x7684;node&#x6392;&#x4E00;&#x4E2A;&#x7B49;&#x7EA7;&#xFF0C;&#x5206;&#x51FA;&#x4E09;&#x516D;&#x4E5D;&#x7B49;&#xFF0C;&#x5BFB;&#x627E;&#x80FD;&#x591F;&#x8FD0;&#x884C;pod&#x7684;&#x82E5;&#x5E72;node&#x4E2D;&#x6700;&#x5408;&#x9002;&#x7684;&#x4E00;&#x4E2A;node&#xFF1B;</li>
<li>&#x5F97;&#x5206;&#x6700;&#x9AD8;&#x7684;&#x4E00;&#x4E2A;node&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x88AB;&#x201C;priority functions&#x201D;&#x9009;&#x4E2D;&#x7684;node&#x80DC;&#x51FA;&#x4E86;&#xFF0C;&#x83B7;&#x5F97;&#x4E86;&#x8DD1;&#x5BF9;&#x5E94;pod&#x7684;&#x8D44;&#x683C;&#x3002;</li>
</ol>
<h2 id="Predicates_&#x548C;_priorities_&#x7B56;&#x7565;">4. Predicates &#x548C; priorities &#x7B56;&#x7565;</h2>
<p>Predicates&#x662F;&#x4E00;&#x4E9B;&#x7528;&#x4E8E;&#x8FC7;&#x6EE4;&#x4E0D;&#x5408;&#x9002;node&#x7684;&#x7B56;&#x7565; . Priorities&#x662F;&#x4E00;&#x4E9B;&#x7528;&#x4E8E;&#x533A;&#x5206;node&#x6392;&#x540D;&#xFF08;&#x5206;&#x6570;&#xFF09;&#x7684;&#x7B56;&#x7565;&#xFF08;&#x4F5C;&#x7528;&#x5728;&#x901A;&#x8FC7;predicates&#x8FC7;&#x6EE4;&#x7684;node&#x4E0A;&#xFF09;. K8s&#x9ED8;&#x8BA4;&#x5185;&#x5EFA;&#x4E86;&#x4E00;&#x4E9B;predicates &#x548C; priorities &#x7B56;&#x7565;&#xFF0C;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x4ECB;&#x7ECD;&#x5730;&#x5740;&#xFF1A; <a href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-scheduling/scheduler_algorithm.md" target="_blank">scheduler_algorithm.md</a>. Predicates &#x548C; priorities &#x7684;&#x4EE3;&#x7801;&#x5206;&#x522B;&#x5728;&#xFF1A;</p>
<ul>
<li>pkg/scheduler/algorithm/predicates/predicates.go</li>
<li>pkg/scheduler/algorithm/priorities.</li>
</ul>
<h2 id="Scheduler_&#x7684;&#x62D3;&#x5C55;&#x6027;">5. Scheduler &#x7684;&#x62D3;&#x5C55;&#x6027;</h2>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x54EA;&#x4E9B;&#x9884;&#x7F6E;&#x7B56;&#x7565;&#x751F;&#x6548;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x81EA;&#x5DF1;&#x7684;&#x7B56;&#x7565;&#x3002;&#x51E0;&#x4E2A;&#x6708;&#x524D;&#x6211;&#x53F8;&#x6709;&#x4E2A;&#x5947;&#x8469;&#x8C03;&#x5EA6;&#x9700;&#x6C42;&#xFF0C;&#x5F53;&#x65F6;&#x6211;&#x5C31;&#x662F;&#x901A;&#x8FC7;&#x589E;&#x52A0;&#x4E00;&#x4E2A;priorities&#x7B56;&#x7565;&#xFF0C;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;&#x4E86;&#x4E00;&#x4E2A;Scheduler&#x6765;&#x5B9E;&#x73B0;&#x7684;&#x9700;&#x6C42;&#x3002;</p>
<h2 id="&#x8C03;&#x5EA6;&#x7B56;&#x7565;&#x7684;&#x4FEE;&#x6539;">6. &#x8C03;&#x5EA6;&#x7B56;&#x7565;&#x7684;&#x4FEE;&#x6539;</h2>
<p>&#x9ED8;&#x8BA4;&#x8C03;&#x5EA6;&#x7B56;&#x7565;&#x662F;&#x901A;&#x8FC7;<code>defaultPredicates()</code> &#x548C; <code>defaultPriorities()&#x51FD;&#x6570;</code>&#x5B9A;&#x4E49;&#x7684;&#xFF0C;&#x6E90;&#x7801;&#x5728; <code>pkg/scheduler/algorithmprovider/defaults/defaults.go</code>&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x547D;&#x4EE4;&#x884C;flag <code>--policy-config-file</code>&#x6765;&#x8986;&#x76D6;&#x9ED8;&#x8BA4;&#x884C;&#x4E3A;&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x65B9;&#x5F0F;&#x6216;&#x8005;&#x4FEE;&#x6539;<code>pkg/scheduler/algorithm/predicates/predicates.go</code> /<code>pkg/scheduler/algorithm/priorities</code>&#xFF0C;&#x7136;&#x540E;&#x6CE8;&#x518C;&#x5230;<code>defaultPredicates()</code>/<code>defaultPriorities()</code>&#x6765;&#x5B9E;&#x73B0;&#x3002;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7C7B;&#x4F3C;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x6837;&#x5B50;&#xFF1A;</p>
<pre class="language-"><code class="lang-json"><span class="token punctuation">{</span>
<span class="token property">&quot;kind&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;Policy&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;apiVersion&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;predicates&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;PodFitsHostPorts&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;PodFitsResources&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;NoDiskConflict&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;NoVolumeZoneConflict&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;MatchNodeSelector&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;HostName&quot;</span><span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token property">&quot;priorities&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;LeastRequestedPriority&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;weight&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;BalancedResourceAllocation&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;weight&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;ServiceSpreadingPriority&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;weight&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;EqualPriority&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;weight&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token property">&quot;hardPodAffinitySymmetricWeight&quot;</span> <span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
<span class="token property">&quot;alwaysCheckAllPredicates&quot;</span> <span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre>
<p>ok&#xFF0C;&#x770B;&#x5230;&#x8FD9;&#x91CC;&#x5927;&#x4F19;&#x5E94;&#x8BE5;&#x5728;&#x6D41;&#x7A0B;&#x4E0A;&#x5BF9;Scheduler&#x7684;&#x539F;&#x7406;&#x6709;&#x4E2A;&#x611F;&#x6027;&#x7684;&#x8BA4;&#x8BC6;&#x4E86;&#xFF0C;&#x4E0B;&#x4E00;&#x8282;&#x6211;&#x4EEC;&#x5C31;&#x5F00;&#x59CB;&#x770B;&#x4E00;&#x4E0B;Scheduler&#x6E90;&#x7801;&#x662F;&#x600E;&#x4E48;&#x5199;&#x7684;&#x3002; </p>
<footer class="page-footer"><span class="copyright">Copyright &#xA9; farmer.hutao@outlook.com 2019 all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x8BE5;&#x6587;&#x4EF6;&#x4FEE;&#x8BA2;&#x65F6;&#x95F4;&#xFF1A;
2019-02-27 16:24:20
</span></footer><div id="anchors-navbar"><i class="fa fa-anchor"></i><ul><p><a href="#&#x8C03;&#x5EA6;&#x5668;&#x8BBE;&#x8BA1;">&#x8C03;&#x5EA6;&#x5668;&#x8BBE;&#x8BA1;</a></p><li><a href="#&#x6982;&#x8FF0;">1. &#x6982;&#x8FF0;</a></li><li><a href="#&#x6E90;&#x7801;&#x5C42;&#x7EA7;">2. &#x6E90;&#x7801;&#x5C42;&#x7EA7;</a></li><li><a href="#&#x8C03;&#x5EA6;&#x7B97;&#x6CD5;">3. &#x8C03;&#x5EA6;&#x7B97;&#x6CD5;</a></li><li><a href="#Predicates_&#x548C;_priorities_&#x7B56;&#x7565;">4. Predicates &#x548C; priorities &#x7B56;&#x7565;</a></li><li><a href="#Scheduler_&#x7684;&#x62D3;&#x5C55;&#x6027;">5. Scheduler &#x7684;&#x62D3;&#x5C55;&#x6027;</a></li><li><a href="#&#x8C03;&#x5EA6;&#x7B56;&#x7565;&#x7684;&#x4FEE;&#x6539;">6. &#x8C03;&#x5EA6;&#x7B56;&#x7565;&#x7684;&#x4FEE;&#x6539;</a></li></ul></div><a href="#&#x6982;&#x8FF0;" id="goTop"><i class="fa fa-arrow-up"></i></a>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: scheduler">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="before-scheduler-run.html" class="navigation navigation-next " aria-label="Next page: 调度程序启动前逻辑">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"调度器设计","level":"2.2.1","depth":2,"next":{"title":"调度程序启动前逻辑","level":"2.2.2","depth":2,"path":"core/scheduler/before-scheduler-run.md","ref":"core/scheduler/before-scheduler-run.md","articles":[]},"previous":{"title":"scheduler","level":"2.2","depth":1,"path":"core/scheduler/README.md","ref":"core/scheduler/README.md","articles":[{"title":"调度器设计","level":"2.2.1","depth":2,"path":"core/scheduler/design.md","ref":"core/scheduler/design.md","articles":[]},{"title":"调度程序启动前逻辑","level":"2.2.2","depth":2,"path":"core/scheduler/before-scheduler-run.md","ref":"core/scheduler/before-scheduler-run.md","articles":[]},{"title":"调度器框架","level":"2.2.3","depth":2,"path":"core/scheduler/scheduler-framework.md","ref":"core/scheduler/scheduler-framework.md","articles":[]},{"title":"一般调度过程","level":"2.2.4","depth":2,"path":"core/scheduler/generic-scheduler.md","ref":"core/scheduler/generic-scheduler.md","articles":[]},{"title":"预选过程","level":"2.2.5","depth":2,"path":"core/scheduler/predicate.md","ref":"core/scheduler/predicate.md","articles":[]},{"title":"优选过程","level":"2.2.6","depth":2,"path":"core/scheduler/priority.md","ref":"core/scheduler/priority.md","articles":[]},{"title":"抢占调度","level":"2.2.7","depth":2,"path":"core/scheduler/preempt.md","ref":"core/scheduler/preempt.md","articles":[]},{"title":"调度器初始化","level":"2.2.8","depth":2,"path":"core/scheduler/init.md","ref":"core/scheduler/init.md","articles":[]},{"title":"关键数据结构分析","level":"2.2.9","depth":2,"path":"core/scheduler/struct.md","ref":"core/scheduler/struct.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["theme-comscore","codeblock-filename","navigator","simple-page-toc","expandable-chapters-small","search-pro","splitter","multipart","tbfed-pagefooter","prism","-highlight","editlink","github","github-buttons@2.1.0","donate","copy-code-button"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright &copy farmer.hutao@outlook.com 2019","modify_label":"该文件修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"prism":{},"github":{"url":"https://github.com/farmer-hutao/k8s-source-code-analysis"},"editlink":{"label":"编辑本页","multilingual":false,"base":"https://github.com/farmer-hutao/k8s-source-code-analysis/edit/master"},"simple-page-toc":{"maxDepth":4,"skipFirstH1":true},"splitter":{},"search-pro":{"cutWordLib":"nodejieba","defineWord":["Gitbook Use"]},"search":{},"multipart":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"donate":{"alipay":"","alipayText":"支付宝打赏","button":"鼓励作者","title":"催作者快快更新","wechat":"./image/wx.jpg","wechatText":"微信小额捐赠，鼓励作者尽快更新～"},"fontsettings":{"theme":"white","family":"sans","size":2},"codeblock-filename":{},"theme-comscore":{},"navigator":{},"github-buttons":{"repo":"farmer-hutao/k8s-source-code-analysis","types":["star"],"size":"small"},"expandable-chapters-small":{},"copy-code-button":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":true}},"theme":"default","author":"Tao Hu <farmer.hutao@outlook.com>","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"《k8s-1.13版本源码分析》","gitbook":"*","description":"k8s source code analysis"},"file":{"path":"core/scheduler/design.md","mtime":"2019-02-27T08:24:20.911Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-04-17T12:24:13.707Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-editlink/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-github-buttons/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-donate/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    </body>
</html>

